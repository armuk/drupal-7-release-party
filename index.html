<!DOCTYPE html>
<html>
<head>
  <title>Drupal 7 Release Party!</title>
  <link type="text/css" rel="stylesheet" media="all" href="style.css" />
</head>
<body>
  <div id="history" class="loading"></div>
  <div id="wrapper" class="loading">
    <div id="info">
      <div id="avatar"><img width="48" height="48" /></div>
      <div id="username"></div>
      <div id="source"></div>
    </div>
    <div id="content"></div>
  </div>
  
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.js"></script>
  <script type="text/javascript" src="helpers.js"></script>
  <script type="text/javascript" src="pool.js"></script>
  <script type="text/javascript" src="flickr.js"></script>
  <script type="text/javascript" src="twitter.js"></script>
  <script type="text/javascript" src="facebook.js"></script>
  <script type="text/javascript">
    /**
     * Configure me!
     */
    var config = {
      // Flickr tags to pull images from.
      queries: ['drupal', 'd7rp'],
      
      // Flickr API key.
      flickr_api_key: 'ae64df56f1ba99b66dd10e7d7540045d',
      
      // UI update speed.
      ui_speed: 7000
    };
    
    // Globalz.
    var data_interval,
      ui_interval,
      $wrapper = $('#wrapper'),
      $source = $('#source'),
      $username = $('#username'),
      $avatar = $('#avatar'),
      $content = $('#content'),
      $history = $('#history');
    
    // Document ready.
    $(function() {
      flickr.api_key = config.flickr_api_key;
      
      // Create a new data pool with twitter, facebook and flickr as sources.
      var pool = new DataPool([twitter, facebook, flickr], config.queries);
      
      // Update the UI every X seconds.
      ui_interval = setInterval(function() {
        $('.loading').removeClass('loading');
        
        // Grab a random object from the pool.
        var object = pool.pluck();
        
        // Update the UI with the object's data.
        if (object) {
          $wrapper.fadeOut('slow', function() {
            $username.text(object.user);
            $avatar.find('img').attr('src', object.avatar);
            $content.html(object.content);
            $source.text(object.source);
            $content.attr('class', object.source.toLowerCase());
            $wrapper.fadeIn();
          });
          
          // Save history.
          remember(object);
        }
      }, config.ui_speed);
    });
    
    /**
     * Add something to the history sidebar.
     */
    function remember(object) {
      var html = 
        '<a class="history" target="_blank" href="' + object.url + '">' + 
          '<img height="48" width="48" src="' + object.avatar + '" />' + 
          '<span>' + object.user + '</span>' + 
        '</a>';
      $(html).hide().prependTo($history).slideDown();
    }
    
    /**
     * Stop UI and Data timers.
     */
    function stop() {
      if (ui_interval)
        clearInterval(ui_interval);
    }
  </script>
</body>
</html>